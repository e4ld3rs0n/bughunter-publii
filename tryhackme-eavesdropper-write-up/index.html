<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>TryHackMe: Eavesdropper write-up - bughunter.me</title><meta name="description" content="In this article, we will explore the solution to the 'Eavesdropper' challenge, which involves monitoring Linux processes with limited privileges and exploiting the $PATH variable&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#D73A42" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#D73A42"><meta name="apple-mobile-web-app-status-bar-style" content="#D73A42"><link rel="canonical" href="https://e4ld3rs0n.github.io/bughunter-publii/tryhackme-eavesdropper-write-up/"><link rel="alternate" type="application/atom+xml" href="https://e4ld3rs0n.github.io/bughunter-publii/feed.xml"><link rel="alternate" type="application/json" href="https://e4ld3rs0n.github.io/bughunter-publii/feed.json"><meta property="og:title" content="TryHackMe: Eavesdropper write-up"><meta property="og:image" content="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/tryhackme-banner.jpg"><meta property="og:image:width" content="800"><meta property="og:image:height" content="440"><meta property="og:site_name" content="bughunter.me"><meta property="og:description" content="In this article, we will explore the solution to the 'Eavesdropper' challenge, which involves monitoring Linux processes with limited privileges and exploiting the $PATH variable&hellip;"><meta property="og:url" content="https://e4ld3rs0n.github.io/bughunter-publii//tryhackme-eavesdropper-write-up/"><meta property="og:type" content="article"><link rel="preload" href="https://e4ld3rs0n.github.io/bughunter-publii/assets/dynamic/fonts/redhatmono/redhatmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://e4ld3rs0n.github.io/bughunter-publii/assets/dynamic/fonts/redhatmono/redhatmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://e4ld3rs0n.github.io/bughunter-publii/assets/css/style.css?v=7fa218a425dbbcb21ada335c561af1e5"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://e4ld3rs0n.github.io/bughunter-publii/tryhackme-eavesdropper-write-up/"},"headline":"TryHackMe: Eavesdropper write-up","datePublished":"2023-04-09T14:56+02:00","dateModified":"2025-01-26T18:12+01:00","image":{"@type":"ImageObject","url":"https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/tryhackme-banner.jpg","height":440,"width":800},"description":"In this article, we will explore the solution to the 'Eavesdropper' challenge, which involves monitoring Linux processes with limited privileges and exploiting the $PATH variable&hellip;","author":{"@type":"Person","name":"andrey","url":"https://e4ld3rs0n.github.io/bughunter-publii/authors/andrey/"},"publisher":{"@type":"Organization","name":"andrey"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://e4ld3rs0n.github.io/bughunter-publii/">bughunter.me</a></div><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/blog/" target="_self">blog</a></li><li><a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/ctf/" target="_self">ctf</a></li><li><a href="https://e4ld3rs0n.github.io/bughunter-publii/about-me/" title="About this blog" target="_self">whoami</a></li></ul></nav></header><main class="content"><article class="post"><header><h1 class="post__title">TryHackMe: Eavesdropper write-up</h1><div class="post__meta"><time datetime="2023-04-09T14:56" class="post__date">Sunday, 9 April 2023 </time><span class="post__author"><a href="https://e4ld3rs0n.github.io/bughunter-publii/authors/andrey/" class="feed__author">andrey</a></span></div><div class="post__tags"><a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/ctf/" class="invert">ctf</a> <a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/tryhackme/" class="invert">tryhackme</a></div></header><figure class="post__image post__cover"><img src="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/tryhackme-banner.jpg" srcset="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-banner-xs.jpg 300w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-banner-sm.jpg 480w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-banner-md.jpg 768w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-banner-lg.jpg 1024w" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" loading="eager" height="440" width="800" alt=""></figure><div class="post__entry"><p></p><p>In this article, we will explore the solution to the "Eavesdropper" challenge, which involves monitoring Linux processes with limited privileges and exploiting the $PATH variable to gain root access on the target system.</p><p></p><p></p><p>Link: <a href="https://tryhackme.com/room/eavesdropper" target="_blank" rel="noreferrer noopener"></a><a href="https://tryhackme.com/room/eavesdropper" target="_blank" rel="noreferrer noopener"></a><a href="https://tryhackme.com/room/eavesdropper" target="_blank" rel="noreferrer noopener">https://tryhackme.com/room/eavesdropper</a></p><p></p><p></p><p>Difficulty: <code>Medium</code></p><p></p><p></p><p>Authors: <code>tryhackme</code>, <code>JohnHammond</code>, <code>cmnatic</code>, <code>timtaylor</code></p><p></p><p></p><p>We begin the challenge with an SSH private key and a username (frank), which grant us access to the target system. Our objective is to escalate privileges and ultimately attain root access.</p><p></p><p></p><p>I initiated the challenge by conducting an nmap scan, but the results only revealed the SSH service.</p><p></p><p></p><p>Proceeding to connect to the machine using the provided credentials, I explored the system but found nothing of particular interest. At this point, I decided to utilize pspy (<a href="https://github.com/DominicBreuker/pspy" data-type="URL" data-id="https://github.com/DominicBreuker/pspy">GitHub</a>). This program enables us to view all active processes on the system without requiring root permissions. I set up a Python HTTP server, transferred the tool to the target machine, and executed it. Upon doing so, I observed something intriguing:</p><p></p><p></p><figure class="wp-block-image size-large"><figure class="wp-image-68"><img loading="lazy" src="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/tryhackme-eavesdropper-pspy-screenshot-1024x530.png" alt="" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-eavesdropper-pspy-screenshot-1024x530-xs.png 300w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-eavesdropper-pspy-screenshot-1024x530-sm.png 480w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-eavesdropper-pspy-screenshot-1024x530-md.png 768w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-eavesdropper-pspy-screenshot-1024x530-lg.png 1024w"></figure></figure><p></p><p></p><p>It appears that another user periodically logs into the system as frank and employs sudo to access the /etc/shadow file approximately every 30 seconds.</p><p></p><p></p><p>The intriguing aspect of this situation is that this other user shares the bash environment with us, and we have full control over various aspects of this environment. One critical element we can manipulate is the $PATH variable, which determines the directories in which the shell searches for executable files. By altering the .bashrc file, which is executed each time a new shell is opened, we can effectively hijack the commands used by the other user.</p><p></p><p></p><p>The .bashrc file is an important configuration file for the Bash shell, which is the default command-line interface on many Linux and UNIX-based systems. This file is located in each user's home directory and is executed each time a new terminal session or shell is opened. The .bashrc file allows users to customize their shell environment by defining aliases, setting environment variables, adjusting the command prompt, and more.</p><p></p><p></p><p>In this specific case, our goal is to intercept the sudo command. By modifying the $PATH variable in .bashrc, we can direct the system to execute a custom sudo script that we create, instead of the original sudo command. This allows us to exploit the other user's actions and ultimately escalate our privileges on the target machine.</p><p></p><p></p><p>I went ahead and tweaked the /home/frank/.bashrc file. Notice "/tmp:" added to the start of the path string, like this:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="bash" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group=""># ~/.bashrc: executed by bash(1) for non-login shells.# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)# for examplesPATH="/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin"...</pre><p></p><p></p><p>With our changes in place, the next time the 'frank' user attempts to execute a command, the system will first search the /tmp directory. If a matching command is found there, the system will execute it, bypassing any subsequent directories in the $PATH.</p><p></p><p></p><p>At this point I proceeded to create a fake sudo script in the /tmp directory containing the following content:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="bash" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">#!/bin/bashread -sp "[sudo] password for $USER: " passvarecho $passvar &gt; /tmp/frank_pwd.txtecho</pre><p></p><p></p><p>The purpose of this script is to imitate a genuine sudo prompt, request user input, and then store the input in a file named /tmp/frank_pwd.txt. After creating the script, I granted it execution permissions using the command <code>chmod +x /tmp/sudo</code>. To verify if everything is set up correctly, we can either load our modified bash profile by running <code>source ~/.bashrc</code> or log out and log back in. Then, we can test the functionality by executing a sudo command, such as <code>sudo somecommand</code>and observe the content of the /tmp/frank_pwd.txt file.</p><p></p><p></p><p>Now, all that's left to do is wait for a few seconds. As anticipated a frank_pwd.txt file materializes in the /tmp directory, revealing the password for the 'frank' user:</p><p></p><p></p><figure class="wp-block-image size-large"><figure class="wp-image-69"><img loading="lazy" src="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/tryhackme-eavesdropper-franks-password-1024x505.png" alt="" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-eavesdropper-franks-password-1024x505-xs.png 300w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-eavesdropper-franks-password-1024x505-sm.png 480w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-eavesdropper-franks-password-1024x505-md.png 768w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/7/responsive/tryhackme-eavesdropper-franks-password-1024x505-lg.png 1024w"></figure></figure><p></p><p></p><p>Having successfully obtained the password, we now have complete access to sudo and, consequently, root privileges. The final steps involve restoring the $PATH variable to its original state and reloading the bash profile. Alternatively, we can rename our counterfeit sudo script to something else or invoke the genuine sudo command using its full path,<code>/usr/bin/sudo</code>. With these actions complete, we can acquire the flag:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">$ sudo cat /root/flag.txt[sudo] password for frank:flag{REDACTED}</pre><p></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on Sunday, 26 January 2025</p><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fe4ld3rs0n.github.io%2Fbughunter-publii%2Ftryhackme-eavesdropper-write-up%2F" class="js-share invert facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://e4ld3rs0n.github.io/bughunter-publii/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fe4ld3rs0n.github.io%2Fbughunter-publii%2Ftryhackme-eavesdropper-write-up%2F" class="js-share invert linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://e4ld3rs0n.github.io/bughunter-publii/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://api.whatsapp.com/send?text=TryHackMe%3A%20Eavesdropper%20write-up https%3A%2F%2Fe4ld3rs0n.github.io%2Fbughunter-publii%2Ftryhackme-eavesdropper-write-up%2F" class="js-share invert whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://e4ld3rs0n.github.io/bughunter-publii/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://e4ld3rs0n.github.io/bughunter-publii/tryhackme-md2pdf-write-up-2/" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  TryHackMe: MD2PDF write-up "><span class="btn__icon">←</span> <span class="btn__text">TryHackMe: MD2PDF write-up</span> </a><a href="https://e4ld3rs0n.github.io/bughunter-publii/tryhackme-opacity-write-up/" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  TryHackMe: Opacity write-up "><span class="btn__text">TryHackMe: Opacity write-up</span> <span class="btn__icon">→</span></a></div></nav></article><div class="post__comments"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div id="commento"></div><noscript>Please enable JS to use the comments form.</noscript><script type="text/javascript">var commento_element_to_check = document.getElementById('commento');

				if ('IntersectionObserver' in window) {
					var iObserver = new IntersectionObserver(
						(entries, observer) => {
							entries.forEach(entry => {
								if (entry.intersectionRatio >= 0.1) {
									(function () {
										var d = document, s = d.createElement('script');
										s.defer = true;
										s.setAttribute('data-no-fonts','true');
										s.setAttribute('data-page-id','7');
										s.setAttribute('data-hide-deleted','false');
										s.src = 'https://cdn.commento.io/js/commento.js';									
										(d.head || d.body).appendChild(s);
									})();
									observer.unobserve(entry.target);
								}
							});
						},
						{
							threshold: [0, 0.2, 0.5, 1]
						}
					);

					iObserver.observe(commento_element_to_check);
				} else {
					(function () {
						var d = document, s = d.createElement('script');
						s.defer = true;
						s.setAttribute('data-no-fonts','true');
						s.setAttribute('data-page-id','7');
						s.setAttribute('data-hide-deleted','false');
						s.src = 'https://cdn.commento.io/js/commento.js';
						(d.head || d.body).appendChild(s);
					})();
				}</script><script type="text/javascript"></script></div></div></div></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>© 2023 - 2025 BugHunter</p></div></div></footer></div><script defer="defer" src="https://e4ld3rs0n.github.io/bughunter-publii/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'overlay',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script>class Rot18Encoder { constructor() { this.rotations = [ { from: 'a', to: 'z', offset: 18 }, { from: 'A', to: 'Z', offset: 18 }, { from: '0', to: '9', offset: 5 } ]; } _rotate(char, from, to, offset) { const charCode = char.charCodeAt(0); const fromCode = from.charCodeAt(0); const toCode = to.charCodeAt(0); const range = toCode - fromCode + 1; if (charCode >= fromCode && charCode <= toCode) { const shiftedCode = ((charCode - fromCode + offset) % range) + fromCode; return String.fromCharCode(shiftedCode); } return char; } encode(text) { let encodedText = ""; for(let char of text){ let rotatedChar = char; for (const rot of this.rotations){ rotatedChar = this._rotate(rotatedChar, rot.from, rot.to, rot.offset); } encodedText += rotatedChar; } return encodedText; } decode(text) { let decodedText = ""; for(let char of text){ let rotatedChar = char; for (const rot of this.rotations){ rotatedChar = this._rotate(rotatedChar, rot.from, rot.to, rot.to.charCodeAt(0) - rot.from.charCodeAt(0) + 1 - rot.offset); } decodedText += rotatedChar; } return decodedText; } } class TextProcessor { constructor(encoder){ this.encoder = encoder; } encode(text){ return this.encoder.encode(text); } decode(text){ return this.encoder.decode(text); } } document.addEventListener('DOMContentLoaded', function() { const rot18 = new Rot18Encoder(); const coder = new TextProcessor(rot18); var obfElements = document.querySelectorAll('.obfuscated-email'); obfElements.forEach(function(elem) { var dataType = elem.getAttribute('data-type'); var encodedEmail = elem.getAttribute('data-email'); var user = elem.getAttribute('data-user'); var domain = elem.getAttribute('data-domain'); var decodedEmail = ''; if (user && domain) { decodedEmail = coder.decode(user) + '@' + coder.decode(domain); } else if (encodedEmail) { const parts = encodedEmail.split('@'); if (parts.length === 2) { decodedEmail = coder.decode(parts[0]) + '@' + coder.decode(parts[1]); } else { decodedEmail = encodedEmail; } } if (dataType === 'mailto') { var originalText = elem.textContent.trim(); var a = document.createElement('a'); a.href = 'mailto:' + decodedEmail; if (elem.classList.length > 0) { a.className = elem.className; } if (originalText === '') { a.textContent = decodedEmail; } else { a.textContent = originalText; } elem.parentNode.replaceChild(a, elem); } else if (dataType === 'text') { var textNode = document.createTextNode(decodedEmail); elem.parentNode.replaceChild(textNode, elem); } }); });</script></body></html>